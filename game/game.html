<html>
	<head>
		<script src="http://code.createjs.com/createjs-2013.12.12.min.js"></script>
		<script src="./Player.js"></script>
		<script src="./Tube.js"></script>
		<script>
			//game classes
			var player;			//player ship
			var deadPlanet;
			var targetPlanet;
			var array_tube;		//tube

			//sprites
			var img_planet;
			var ss_planets;

			//work classes
			var canvas;
			var stage;
			var message;
			var loader;
			
			//document.onkeydown = handleKeyDown;
			//document.onkeyup = handleKeyUp;
			
			function init() 
			{
				document.getElementById("mobile").style.display = "none";
				document.getElementById("error").style.display = "none";

				if (!createjs.Sound.initializeDefaultPlugins()) 
				{
					document.getElementById("error").style.display = "block";
					document.getElementById("content").style.display = "none";
					return;
				}

				if (createjs.Sound.BrowserDetect.isIOS || createjs.Sound.BrowserDetect.isAndroid || createjs.Sound.BrowserDetect.isBlackberry)
				{
					document.getElementById("mobile").style.display = "block";
					document.getElementById("content").style.display = "none";
					return;
				}

				canvas = document.getElementById("worlds");
				stage = new createjs.Stage(canvas);

				/*message = new createjs.Text("Loading", "bold 24px Arial", "#FFFFFF");
				message.maxWidth = 1000;
				message.textAlign = "center";
				message.x = canvas.width / 2;
				message.y = canvas.height / 2;
				stage.addChild(message);
				stage.update();*/

				manifest = [
					{src:"./img/planet.png", id:"planet"},
				];

				loader = new createjs.LoadQueue(false);
				loader.addEventListener("complete", handleComplete);
				loader.loadManifest(manifest);
			}

			function handleComplete(event)
			{
				img_planet = loader.getResult("planet");

				player = new Player();
				player.x = 50;
				player.y = 50;

				ss_planets = new createjs.SpriteSheet({
					images: [img_planet],
					frames: { width: 50, height: 50 },
					animations: { alive: [0], dead: [1] }	//TODO add "change"
				});

				deadPlanet = new createjs.Sprite(ss_planets, "dead");
				deadPlanet.x = 50;
				deadPlanet.y = canvas.height/2;

				targetPlanet = new createjs.Sprite(ss_planets, "alive");
				targetPlanet.x = canvas.width - 50;
				targetPlanet.y = canvas.height/2;

				stage.addChild(player);
				stage.addChild(deadPlanet);
				stage.update();
			}
		</script>
		<style type="text/css">
			#content {
				user-select: none;
				background-color:#000000;
				width: 800px;
				height: 600px;
			}
		</style>
	</head>
	<body onLoad="init();">
		<div id="content">
			<canvas id="worlds" width="800" height="600"></canvas>
		</div>

		<!-- TODO make links! -->
		<div id="error">
			<h1>Oops!</h1>
			<p>SoundJS is not currently supported in your browser. Try to use Chrome.</p>
		</div>

		<div id="mobile">
			<h1>Oops!</h1>
			<p>Mobile devices isn't supported...</p>
		</div>
	</body>
</html>